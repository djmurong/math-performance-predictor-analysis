---
title: "EDA"
fig-width: 8
fig-asp: 0.618
---

```{r}
#| label: load-packages
library(tidyverse)
library(tidymodels)
library(readxl)
```

```{r}
#| label: load-data
edu_achievement <- read_excel(
  "data/educationachievement.xlsx",
  skip = 1
)
glimpse(edu_achievement)
```

```{r}
#| label: pivot-longer
edu_achievement_longer <- edu_achievement |>
  pivot_longer(
    cols = c("Dalc", "Walc"),
    names_to = "alc_type",
    values_to = "alc_lvl"
  )
```

@fig-g3-failures highlights differences in medians of students' final grades across the number of past class fails they have.

```{r}
#| label: fig-g3-failures
#| layout-ncol: 2
#| fig-cap: Final Grade vs. Number of Past Class Failures
ggplot(edu_achievement, aes(x = failures, y = G3, group = failures, color = failures)) +
  geom_boxplot() +
  labs(
    title = "Final Grade vs Number of Past Class Failures",
    x = "Number of Past Class Failures",
    y = "Final Grade"
  ) +
  theme(legend.position = "none")

ggplot(edu_achievement, aes(x = failures, y = G3)) +
  geom_point() +
  geom_smooth(method = "lm")
  labs(
    title = "Final Grade vs Number of Past Class Failures",
    x = "Number of Past Class Failures",
    y = "Final Grade"
  )
```

```{r}
#| label: failures-summarize
edu_achievement |>
  group_by(failures) |>
  summarize(
    median = median(G3),
    mean = mean(G3)
  )
```

Based on the plots and the summary of median and mean values for final grades, we observe a weak, negative, linear relationship between the number of past class failures and the final grade.
We will now determine the linear regression equation for final grade vs past class failures.

```{r}
#| label: g3-failures-lin-reg
g3_failures_fit <- linear_reg() |>
  fit(G3 ~ failures, data = edu_achievement)

tidy(g3_failures_fit)
```

We get the following equation: $$\widehat{final~grade} = 11.16 - 2.22 \times failures$$

```{r}
#| label: r-r-squared
edu_achievement |>
  summarize(
    r = cor(failures, G3),
    r_squared = r^2
  )
```
From the summary, we see that the correlation is weak, and the R-squared value is very low. The low R-squared indicates that the variability of final grades that the model can explain with the variable of past class failures is very low, only 13%. Thus, we deem the number of past class failures as a weak predictor/factor for math performance.

```{r}
#| label: fig-wacl-dalc-g3
new_labels <- c("Dalc" = "Weekday", "Walc" = "Weekend")

edu_achievement_longer |>
  mutate(
    alc_type = fct_relevel(alc_type, c("Dalc", "Walc"))
  ) |>
ggplot(aes(x = alc_lvl, y = G3, group = alc_lvl, color = alc_lvl)) +
  geom_boxplot() +
  facet_grid(rows = vars(alc_type), labeller = labeller(.rows = new_labels)) +
  labs(
    title = "Final Grade vs Alcoholic Consumption Level",
    subtitle = "Separated by Weekday and Weekend",
    x = "Alcoholic Consumption Level",
    y = "Final Grade"
  ) +
  theme(legend.position = "none")
```

```{r}
#| label: alc-summarize
edu_achievement_longer |>
  group_by(alc_lvl, alc_type) |>
  summarize(
    median = median(G3),
    mean = mean(G3)
  )
```

The faceted side-by-side boxplots and the summary show that the distributions of final grades for each combination of alcohol consumption type (weekday or weekend) and level all center at approximately 10-11.
The variability seems to lower as alcohol consumption of either form increases.
However, there does not appear to have any substantial changes in variability across the form of alcohol consumption.
Since there are only very marginal observed changes due to changes in alcohol consumption type and level, alcohol consumption does not seem to be a strong factor for math performance.

```{r}
#| label: fig-medu-g3
#| layout-nrow: 2
ggplot(edu_achievement, aes(x = Medu, y = G3)) + 
  geom_point() + 
  geom_smooth(method = "lm") + 
  labs(
    x = "Mother’s Education Level",
    y = "Final Grade (1-20)",
    title = "Final Grade of Students Based on Mother’s Education Level",
    subtitle = "Student Serformance in Math in the Portugueuse schools of 
Gabriel Pereira and Mousinho da Silveira"
  )

ggplot(edu_achievement, aes(x = Fedu, y = G3)) + 
  geom_point() + 
  geom_smooth(method = "lm") + 
  labs(
    x = "Father’s Education Level",
    y = "Final Grade (1-20)",
    title = "Final Grade of Students Based on Father’s Education Level",
    subtitle = "Student Serformance in Math in the Portugueuse schools of 
Gabriel Pereira and Mousinho da Silveira"
  )
```

```{r}
#| label: fig-internet-g3
ggplot(edu_achievement, aes(x = internet, y = G3, fill = internet)) +
  geom_boxplot(alpha = 0.7) +
  labs(
    title = "Distribution of Final Grades (G3) by Internet Access",
    x = "Internet Access",
    y = "Final Grade (G3)"
  ) +
  theme_minimal(base_size = 14) +
  theme(legend.position = "none")

edu_achievement |>
  group_by(internet) |>
  summarize(
    median = median(G3, na.rm = TRUE),
    mean = mean(G3, na.rm = TRUE),
    .groups = "drop"
  )

```
Students with internet access had slightly higher average and median final grades.This suggests that internet access may provide academic advantages — possibly through easier access to online learning materials, homework help, or communication with teachers.
```{r}
#| label: health-g3-plot
ggplot(edu_achievement, aes(x = health, y = G3)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm") +
  labs(
    title = "Relationship Between Health Status and Final Grade (G3)",
    x = "Health Status (1 = Poor, 5 = Excellent)",
    y = "Final Grade (G3)"
  ) +
  theme_minimal(base_size = 14)

edu_achievement |>
  group_by(health) |>
  summarize(
    median = median(G3, na.rm = TRUE),
    mean = mean(G3, na.rm = TRUE),
    .groups = "drop"
  )
```
There is a mild positive trend where students reporting better health (1–5 scale) tend to have slightly higher grades. The slope from the regression equation will likely be small but positive, suggesting that overall health may have a modest influence on academic outcomes.
```{r}
ggplot(edu_achievement, aes(x = famrel, y = G3)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm") +
  labs(
    title = "Relationship Between Family Relationship Quality and Final Grade (G3)",
    x = "Family Relationship Quality (1 = Very Bad, 5 = Excellent)",
    y = "Final Grade (G3)"
  ) +
  theme_minimal(base_size = 14)


edu_achievement |>
  group_by(famrel) |>
  summarize(
    median = median(G3, na.rm = TRUE),
    mean = mean(G3, na.rm = TRUE),
    .groups = "drop"
  )
```
Family relationship strength shows a small, mostly stable pattern — students who report stronger family relationships have slightly higher grades on average. The regression may produce a weak positive slope, indicating potentially supportive effects of a positive home environment on academic achievement.
```{r}
#| label: fig-paid-g3
#| message: false
ggplot(edu_achievement, aes(x = paid, y = G3)) +
  geom_boxplot()
```

```{r}
#| label: fig-freetime-g3
#| message: false
ggplot(edu_achievement, aes(x = freetime, y = G3)) +
  geom_point()
```

```{r}
#| label: dem-vars-model-fit
dem_vars = c(
  "school",
  "sex",
  "age",
  "address",
  "famsize",
  "Pstatus",
  "Medu",
  "Fedu",
  "Mjob",
  "Fjob",
  "reason",
  "guardian"
)
formula_str_dem <- paste("G3 ~", paste(dem_vars, collapse = " + "))
rec_dem <- recipe(as.formula(formula_str_dem), data = edu_achievement)

dem_model <- linear_reg()

wf_dem <- workflow() |>
  add_recipe(rec_dem) |>
  add_model(dem_model)

dem_model <- fit(wf_dem, data = edu_achievement)

tidy(dem_model)
```

```{r}
#|label: study-vars-model-fit
study_vars = c(
  "studytime",
  "failures",
  "schoolsup",
  "famsup",
  "paid",
  "activities",
  "nursery",
  "higher",
  "internet",
  "romantic",
  "famrel",
  "freetime",
  "goout",
  "Dalc",
  "Walc",
  "health",
  "absences"
)
formula_str_study <- paste("G3 ~", paste(study_vars, collapse = " + "))
rec_study <- recipe(as.formula(formula_str_study), data = edu_achievement)

study_model <- linear_reg()

wf_study <- workflow() |>
  add_recipe(rec_study) |>
  add_model(study_model)

study_model <- fit(wf_study, data = edu_achievement)

tidy(study_model)
```

```{r}
#| label: glance
glance(dem_model)

glance(study_model)
```

We observe from the p-values of the variables in the two models, that several of them are not statistically significant for fitting.
We will examine new models with variables having p-values lower than 0.05 (5e-2).

```{r}
#| label: reduced-dem-model
dem_vars_reduced = c(
  "sex",
  "age",
  "reason"
)
formula_str_dem_reduced <- paste("G3 ~", paste(dem_vars_reduced, collapse = " + "))
rec_dem_reduced <- recipe(as.formula(formula_str_dem_reduced), data = edu_achievement)

dem_model_reduced <- linear_reg()

wf_dem_reduced <- workflow() |>
  add_recipe(rec_dem_reduced) |>
  add_model(dem_model_reduced)

dem_model_reduced <- fit(wf_dem_reduced, data = edu_achievement)

tidy(dem_model_reduced)
```

```{r}
#| label: reduced-study-model
study_vars_reduced = c(
  "failures",
  "romantic",
  "goout"
)
formula_str_study_reduced <- paste("G3 ~", paste(study_vars_reduced, collapse = " + "))
rec_study_reduced <- recipe(as.formula(formula_str_study_reduced), data = edu_achievement)

study_model_reduced <- linear_reg()

wf_study_reduced <- workflow() |>
  add_recipe(rec_study_reduced) |>
  add_model(study_model_reduced)

study_model_reduced <- fit(wf_study_reduced, data = edu_achievement)

tidy(study_model_reduced)
```

```{r}
#| label: glance-reduced
glance(dem_model_reduced)

glance(study_model_reduced)
```

Based on the results of the multiple regression models, there does not appear to be any strong predictor of educational performance.
